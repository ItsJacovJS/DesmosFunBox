(function(){Calc.setBlank();var p=0,bullets=[],enemies=[],score=0,tick=0;var keys={up: false,down: false,space: false};var inMenu=true;var isGameOver=false;var highscore=0;function setupGraph(){Calc.setExpressions([{id: 'border',latex: 'x=10\\{-10<y<10\\},x=-10\\{-10<y<10\\},y=10\\{-10<x<10\\},y=-10\\{-10<x<10\\}',color: '#000000',lineWidth: 5},{id: 'e_fn',latex: 'f_{box}(c)=\\operatorname{polygon}(c+(.5,.5),c+(-.5,.5),c+(-.5,-.5),c+(.5,-.5))'},{id: 'player',latex: 'x=-7\\{p-1<y<p+1\\}',color: '#000000'},{id: 'b_draw',latex: '\\operatorname{segment}(B,B-(0.8,0))',color: '#388c46',lineWidth: 4},{id: 'e_draw',latex: 'f_{box}(E)',color: '#c74440'},{id: 'score_ui',latex: '(0,11)',label: 'SCORE: ${s},HIGH: ${h}',showLabel: true,labelSize: 'large'},{id: 'menu_msg',latex: '(0,0)',pointSize: 0}]);Calc.setMathBounds({left:-12,right: 12,bottom:-12,top: 12})}setupGraph();window.onkeydown=function(e){if(e.code==='ArrowUp')keys.up=true;if(e.code==='ArrowDown')keys.down=true;if(e.code==='Space')keys.space=true;if(e.code==='Enter'&&inMenu){inMenu=false;isGameOver=false;score=0;enemies=[];bullets=[]}};window.onkeyup=function(e){if(e.code==='ArrowUp')keys.up=false;if(e.code==='ArrowDown')keys.down=false;if(e.code==='Space')keys.space=false};setInterval(function(){if(inMenu){Calc.setExpressions([{id: 'menu_msg',label: isGameOver ? "GAME OVER!PRESS ENTER TO RESTART" : "PRESS ENTER TO START",showLabel: true},{id: 's_val',latex: 's='+score},{id: 'h_val',latex: 'h='+highscore}]);return}tick++;if(keys.up&&p<8.5)p+=0.25;if(keys.down&&p>-8.5)p-=0.25;if(keys.space&&tick % 12===0)bullets.push({x:-6.5,y: p});bullets.forEach((b,i)=>{b.x+=0.45;if(b.x>9.5)bullets.splice(i,1)});if(tick % 65===0)enemies.push({x: 10,y:(Math.random()*17)-8.5});enemies.forEach((e,ei)=>{e.x-=0.055;bullets.forEach((b,bi)=>{if(Math.abs(b.x-e.x)<0.7&&Math.abs(b.y-e.y)<0.7){enemies.splice(ei,1);bullets.splice(bi,1);score+=10}});if(e.x<-7&&Math.abs(e.y-p)<1.3){if(score>highscore)highscore=score;inMenu=true;isGameOver=true}});Calc.setExpressions([{id: 'p_val',latex: 'p='+p},{id: 's_val',latex: 's='+score},{id: 'h_val',latex: 'h='+highscore},{id: 'b_data',latex: 'B=['+(bullets.length ? bullets.map(b=>`(${b.x},${b.y})`).join(','): '(99,99)')+']'},{id: 'e_data',latex: 'E=['+(enemies.length ? enemies.map(e=>`(${e.x},${e.y})`).join(','): '(99,99)')+']'},{id: 'menu_msg',showLabel: false}])},1000/50)})();
